<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Parabolic finite difference with WebGL</title>
<link rel="stylesheet" href="style.css" />

<script src="webgl-debug.js"></script>
<script src="jquery.js"></script>

<script src="util.js"></script>
<script src="vector.js"></script>

<script src="solver.js"></script>
<script src="program.js"></script>

<script>
$(function() {
    
    $('#main-canvas').mousemove(function(e) {
            var el = $(this);
            var parentOffset = el.offset();
            var relX = 2 * (e.pageX - parentOffset.left) / el.width() - 1;
            var relY = 2 * (e.pageY - parentOffset.top) / el.height() - 1;
            
            Solver.setLight(relX, -relY, 1);
        }
    );

    $('#save-button').click(function() {
        var canvas = document.getElementById('main-canvas');
        var image = canvas.toDataURL('image/png');
        
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/test.png',
            data: image,
            dataType: 'text'
        });
    });
    
    $('#start-stop').click(function() {
        if (Solver.interval) {
            Solver.stop();
        } else {
            Solver.start();
        }
    });
    
    Solver.loadShaders(Solver.shaderSources, function () {
        var solver = new Solver(document.getElementById('main-canvas'));
        solver.init({
            size: 512,
            computation: 'stefan',
            display: 'twophase',
        });
        
        solver.toggleSimulation(true);
    });
});
</script>
</head>
<body>
<div>
<button id="save-button">Save image</button>
<button id="start-stop">Stop</button>
</div>
<canvas id="main-canvas" style="border: none;" width="512" height="512"></canvas>
<p id="framerate"></p>
</body>
</html>